<!DOCTYPE html>
<html>
<head>
<meta charset="utf8" />
<title>Как собрать mono</title>
</head>
<body>

<table><tr><td style="vertical-align:top;">
<h1>Как собрать mono</h1>
</td><td style="vertical-align:top;">
<a href="../index.htm">Разработка на C# под linux</a>
</td></tr></table>

<h2>Цели</h2>
1) <a href="mono-from-repo-directly.htm">собрать mono из git по SHA1</a> (а не через make dist по меткам)
<br />
2) довести через autoconf tools параметр /p:Configuration:Debug

<h2>Как формируется версия mono?</h2>
Как формируется минорная версия пакета mono ?
<br />
которая видна в
<br />
mono -V
<br />
/usr/bin/mono -> mono-sgen
<br />
/usr/bin/mono-sgen
<br />
можем ли мы глядя на текст ebuild определить как создаётся mono-sgen или mono ?
<br />
<a href="https://raw.githubusercontent.com/gentoo/gentoo/master/dev-lang/mono/mono-4.9.0.729.ebuild">mono-4.9.0.729.ebuild</a>
<br />
mono собирается при помощи autotools
<br />
<a href="https://github.com/mono/mono/blob/master/configure.ac#L5">https://github.com/mono/mono/blob/master/configure.ac#L5</a>
<br />
поэтому там используется макрос <a href="https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Initializing-configure.html">AC_INIT</a>
<br />
It is permissible to use m4_esyscmd or m4_esyscmd_s for computing a version string that changes with every commit to a version control system
(in fact, Autoconf does just that, for all builds of the development tree made between releases).
<br />
AC_PACKAGE_VERSION, PACKAGE_VERSION
<br />
AC_PACKAGE_STRING, PACKAGE_STRING
<br />
Exactly version. 
<br />
<br />
it's an incrementing counter generated by mono's private CI system,
which should be number-of-commits-since-configure.ac-was-changed
<br />
<br />
Как вообще посчитать число коммитов между двумя sha1:
<br />
<a href="http://stackoverflow.com/questions/31997999/number-of-commits-between-two-commitishes">http://stackoverflow.com/questions/31997999/number-of-commits-between-two-commitishes</a>
<br />
git rev-list --count A..B
<br />
<br />
where is the script which does that? is it inside "make dist" ?
<br />
i think it's part of bockbuild...
<br />
<pre>
# Use the following line in your configure.ac, so that $(VERSION) will
# automatically be up-to-date each time configure is run (and note that
# since configure.ac no longer includes a version string, Makefile rules
# should not depend on configure.ac for version updates).
#
# AC_INIT([GNU project],
#         m4_esyscmd([build-aux/git-version-gen .tarball-version]),
#         [bug-project@example])
</pre>
<a href="http://stackoverflow.com/questions/8215785/how-can-i-use-ac-revision-with-git">http://stackoverflow.com/questions/8215785/how-can-i-use-ac-revision-with-git</a>

<h2>Сборка mono</h2>

Некоторые зависимости:
<br />
Submodule 'external/Lucene.Net.Light' (git://<a href="https://github.com/mono/Lucene.Net.Light">github.com/mono/Lucene.Net.Light</a>.git) registered for path 'external/Lucene.Net.Light'
<br />
Submodule 'external/Newtonsoft.Json' (git://<a href="https://github.com/mono/Newtonsoft.Json">github.com/mono/Newtonsoft.Json</a>.git) registered for path 'external/Newtonsoft.Json'
<br />
Submodule 'external/aspnetwebstack' (git:/<a href="/github.com/mono/aspnetwebstack">/github.com/mono/aspnetwebstack</a>.git) registered for path 'external/aspnetwebstack'
<br />
Submodule 'external/reference-assemblies' (git://<a href="https://github.com/mono/reference-assemblies">github.com/mono/reference-assemblies</a>.git) registered for path 'external/binary-reference-assemblies'
<br />
Submodule 'external/cecil' (git://<a href="https://github.com/mono/cecil">github.com/mono/cecil</a>.git) registered for path 'external/cecil'
<br />
Submodule 'external/debian-snapshot' (git://<a href="https://github.com/directhex/mono-snapshot">github.com/directhex/mono-snapshot</a>.git) registered for path 'external/debian-snapshot'
<br />
Submodule 'external/ikdasm' (git://<a href="https://github.com/mono/ikdasm">github.com/mono/ikdasm</a>.git) registered for path 'external/ikdasm'
<br />
Submodule 'external/ikvm' (git://<a href="https://github.com/mono/ikvm-fork">github.com/mono/ikvm-fork</a>.git) registered for path 'external/ikvm'
<div style="margin-left:1em"><a href="https://github.com/gentoo/dotnet/issues/182">https://github.com/gentoo/dotnet/issues/182</a>
<br />
IKVM не собирается, что-то там не так с патчем (вероятно, что билд не работал никогда)
</div>
Submodule 'external/referencesource' (git://<a href="https://github.com/mono/referencesource">github.com/mono/referencesource</a>) registered for path 'external/referencesource'
<br />
Submodule 'external/rx' (git://<a href="https://github.com/mono/rx">github.com/mono/rx</a>.git) registered for path 'external/rx'


<h2>Пакетирование для NuGet</h2>
Иконка в .svg - <a href="https://github.com/mono/mono/blob/master/mcs/ScalableMonoIcon.svg">https://github.com/mono/mono/blob/master/mcs/ScalableMonoIcon.svg</a>
<br />
<img src="https://raw.githubusercontent.com/mono/mono/master/mcs/ScalableMonoIcon.svg" alt="ScalableMonoIcon.svg" />
<br />
<svg width="200" height="200"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink">
  <image x="0" y="0" width="200" height="200" xlink:href="https://raw.githubusercontent.com/mono/mono/master/mcs/ScalableMonoIcon.svg" type="image/svg+xml" />
</svg>

</body>
</html>
